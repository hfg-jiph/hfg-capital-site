<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>HFG CAPITAL | Contacts</title>
  <meta name="description" content="HFG CAPITAL - Contact Private Office" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
  <link rel="shortcut icon" href="favicon/favicon.ico">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    /* --- VARIABLES & RESET --- */
    :root {
      --primary-dark: #1a1a1a;
      --gold-accent: #D4AF37;
      --text-light: #ffffff;
      --font-motto: 'Cinzel', serif; 
      --font-sans: 'Montserrat', sans-serif;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: var(--font-sans);
      min-height: 100vh;
      width: 100vw;
      overflow-x: hidden;
      background-color: #000;
      color: var(--text-light);
      display: flex;
      flex-direction: column;
    }

    /* --- BACKGROUND --- */
    .bg-container {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
    }
    .bg-image {
      width: 100%; height: 100%; object-fit: cover;
      transition: opacity 1s ease;
      display: none; 
    }
    body.dark-mode .bg-image { filter: grayscale(100%) brightness(0.25); }

    /* --- HEADER --- */
    header {
      position: fixed; top: 0; left: 0; width: 100%;
      display: flex; justify-content: space-between; align-items: center;
      padding: 20px 40px; z-index: 100;
      background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
    }

    .header-left { display: flex; align-items: center; gap: 10px; }

    /* --- MENU --- */
    .menu-btn {
      display: inline-flex; align-items: center; justify-content: center;
      width: 34px; height: 34px; border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.2);
      backdrop-filter: blur(5px); background: rgba(255, 255, 255, 0.1);
      cursor: pointer; transition: 0.3s;
    }
    .menu-btn:hover { background: rgba(255, 255, 255, 0.2); border-color: var(--gold-accent); }
    .menu-btn-lines { width: 15px; height: 11px; position: relative; }
    .menu-btn-lines span {
      position: absolute; left: 0; right: 0; height: 1px; background: #fff;
      transition: 0.25s;
    }
    .menu-btn-lines span:nth-child(1) { top: 0; }
    .menu-btn-lines span:nth-child(2) { top: 5px; }
    .menu-btn-lines span:nth-child(3) { bottom: 0; }
    .menu-btn.open .menu-btn-lines span:nth-child(1) { top: 5px; transform: rotate(45deg); }
    .menu-btn.open .menu-btn-lines span:nth-child(2) { opacity: 0; }
    .menu-btn.open .menu-btn-lines span:nth-child(3) { bottom: 5px; transform: rotate(-45deg); }

    .main-menu-overlay {
      position: fixed; inset: 0; background: transparent; display: none;
      align-items: stretch; justify-content: flex-start; z-index: 90;
    }
    .main-menu-overlay.open { display: flex; }
    .main-menu {
      width: 320px; max-width: calc(100% - 80px); margin-top: 70px;
      background: transparent; padding: 24px;
      transform: translateX(-100%); transition: transform 0.25s ease;
    }
    .main-menu-overlay.open .main-menu { transform: translateX(0); }
    .main-menu ul { list-style: none; }
    .main-menu a {
      font-family: var(--font-sans); font-size: 0.675rem; text-transform: uppercase;
      letter-spacing: 0.22em; color: rgba(255,255,255,0.85); text-decoration: none;
      padding: 10px 0; display: block; transition: color 0.2s ease;
    }
    .main-menu a:hover { color: var(--gold-accent); }

    /* --- THEME & LANG --- */
    .theme-btn {
      width: 34px; height: 34px; display: inline-flex; align-items: center; justify-content: center;
      background: rgba(255,255,255,0.1); backdrop-filter: blur(5px);
      border: 1px solid rgba(255,255,255,0.2); border-radius: 20px;
      cursor: pointer; transition: 0.3s;
    }
    .theme-btn:hover { background: rgba(255,255,255,0.2); border-color: var(--gold-accent); }
    .theme-dot {
      width: 14px; height: 14px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.9);
      background: transparent; transition: 0.3s;
    }
    .theme-btn.active .theme-dot { background: rgba(255,255,255,0.95); border-color: rgba(255,255,255,0.95); }

    .lang-container { position: relative; }
    .lang-btn {
      display: flex; align-items: center; gap: 8px;
      background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(5px);
      padding: 0px 12px; height: 34px; border-radius: 20px;
      border: 1px solid rgba(255,255,255,0.2); color: white; cursor: pointer;
      font-size: 0.75rem; transition: 0.3s;
    }
    .lang-btn:hover { background: rgba(255, 255, 255, 0.2); border-color: var(--gold-accent); }
    
    /* CORRECTION DRAPEAUX : Cette règle s'applique aux deux emplacements */
    .lang-btn img, .lang-option img { 
      width: 20px; height: 13px; object-fit: cover; border-radius: 3px; 
    }

    .lang-menu {
      position: absolute; top: 45px; left: 0;
      background: rgba(20, 20, 20, 0.95); border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px; padding: 5px 0; display: none; flex-direction: column;
      width: max-content; min-width: 150px;
      /* On s'assure que le menu ne dépasse pas */
      max-height: 80vh; overflow-y: auto;
    }
    .lang-menu.show { display: flex; animation: fadeIn 0.3s; }
    .lang-option {
      display: flex; align-items: center; gap: 12px; padding: 10px 20px;
      color: #ccc; cursor: pointer; font-size: 0.75rem; border-bottom: 1px solid rgba(255,255,255,0.03);
    }
    .lang-option:last-child { border-bottom: none; }
    .lang-option:hover { background: rgba(212, 175, 55, 0.15); color: white; }

    /* --- LOGIN BTN --- */
    .login-trigger {
      background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(5px); color: white;
      border: 1px solid rgba(255,255,255,0.2); height: 34px; padding: 0px 24px;
      display: flex; align-items: center; border-radius: 20px;
      font-family: var(--font-sans); text-transform: uppercase; font-size: 0.75rem;
      letter-spacing: 2px; cursor: pointer; transition: 0.4s;
    }
    .login-trigger:hover { background: var(--gold-accent); color: var(--primary-dark); }

    /* --- CONTENU --- */
    main {
      flex: 1;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      padding: 120px 20px 60px 20px;
      z-index: 10;
      width: 100%; max-width: 600px; margin: 0 auto;
    }

    .contact-container {
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(10px);
      padding: 40px;
      width: 100%;
      border: 1px solid rgba(255,255,255,0.1);
      animation: fadeInUp 0.8s ease-out;
    }

    .page-title {
      font-family: var(--font-motto);
      font-size: 2rem; color: var(--gold-accent);
      margin-bottom: 30px; text-align: center;
      text-transform: uppercase; letter-spacing: 2px;
    }

    .form-group { margin-bottom: 20px; }
    
    .form-control {
      width: 100%; padding: 15px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.2);
      color: #fff; font-family: var(--font-sans); font-size: 0.9rem;
      outline: none; transition: 0.3s;
      border-radius: 0;
    }
    
    .form-control:focus { background: rgba(255,255,255,0.1); border-color: var(--gold-accent); }
    textarea.form-control { resize: vertical; min-height: 120px; }

    .btn-send {
      width: 100%; padding: 15px;
      background: var(--gold-accent); color: var(--primary-dark);
      border: none; font-family: var(--font-sans); font-weight: 600;
      text-transform: uppercase; letter-spacing: 2px;
      cursor: pointer; transition: 0.3s; margin-top: 10px;
      display: flex; justify-content: center; align-items: center; gap: 10px;
    }
    
    .btn-send:hover { background: #fff; }
    .btn-send:disabled { opacity: 0.7; cursor: not-allowed; background: #999; }

    /* LOADER ICON */
    .spinner {
      width: 16px; height: 16px;
      border: 2px solid rgba(0,0,0,0.2);
      border-left-color: #000;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      display: none; /* Caché par défaut */
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }

    .form-status {
      margin-top: 20px; text-align: center; font-size: 0.85rem; min-height: 20px;
    }
    .status-success { color: #4caf50; }
    .status-error { color: #f44336; }

    /* --- FOOTER --- */
    footer {
      width: 100%; text-align: center; padding: 20px;
      z-index: 10; margin-top: auto;
    }
    .footer-copyright {
      color: rgba(255,255,255,0.4); font-size: 0.6rem;
      text-transform: uppercase; letter-spacing: 1.5px;
    }

    /* --- MODAL LOGIN --- */
    .modal-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.85); backdrop-filter: blur(12px);
      z-index: 1000; display: none; justify-content: center; align-items: center;
    }
    .modal-overlay.active { display: flex; animation: fadeIn 0.4s; }
    .modal-box {
      background: #fff; width: 100%; max-width: 420px; padding: 50px 40px;
      text-align: center; position: relative; color: #333;
    }
    .close-modal {
      position: absolute; top: 10px; right: 15px; font-size: 32px;
      cursor: pointer; color: #bbb;
    }
    .modal-title {
      font-family: var(--font-motto); font-size: 1.6rem;
      margin-bottom: 30px; text-transform: uppercase; color: var(--primary-dark);
    }
    .modal-input {
      width: 100%; padding: 15px; border: 1px solid #e0e0e0; background: #fafafa;
      margin-bottom: 20px; font-family: var(--font-sans); outline: none;
    }
    .modal-input:focus { border-color: var(--gold-accent); background: #fff; }
    .modal-submit {
      width: 100%; padding: 15px; background: var(--primary-dark); color: white;
      border: none; text-transform: uppercase; letter-spacing: 2px; cursor: pointer;
    }
    .modal-error { color: #9e1b1b; font-size: 0.8rem; margin-top: 20px; display: none; }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    @media (max-width: 600px) {
      header { padding: 15px 20px; }
      .contact-container { padding: 30px 20px; }
      .page-title { font-size: 1.5rem; }
    }
  </style>
</head>
<body>

  <div class="bg-container">
    <img id="bgImage" class="bg-image" alt="Background">
  </div>

  <div class="main-menu-overlay" id="mainMenuOverlay">
    <nav class="main-menu">
      <ul>
        <li><a id="menuHome" href="home.html">Accueil</a></li>
        <li><a id="menuAbout" href="about.html">Qui sommes-nous</a></li>
        <li><a id="menuPhilosophy" href="philosophy.html">Philosophie</a></li>
        <li><a id="menuManifesto" href="manifesto.html">Manifesto</a></li>
        <li><a id="menuContacts" href="contacts.html" style="color:var(--gold-accent);">Contacts</a></li>
      </ul>
    </nav>
  </div>

  <header>
    <div class="header-left">
      <div class="menu-container">
        <button class="menu-btn" id="menuBtn">
          <div class="menu-btn-lines"><span></span><span></span><span></span></div>
        </button>
      </div>
      <button class="theme-btn" id="themeBtn"><span class="theme-dot"></span></button>
      <div class="lang-container" id="langContainer">
        <div class="lang-btn" onclick="toggleLangMenu()">
          <img id="currentFlag" src="https://flagcdn.com/fr.svg" alt="FR">
          <span id="currentLangLabel">FR</span> <small>▼</small>
        </div>
        <div class="lang-menu" id="langMenu"></div>
      </div>
    </div>
    <button class="login-trigger" id="openLoginBtn" onclick="openModal()">Accès</button>
  </header>

  <main>
    <div class="contact-container">
      <h1 class="page-title" id="pageTitle">Contacts</h1>
      
      <form id="contactForm" action="https://formspree.io/f/xgvqnowr" method="POST">
        <div class="form-group">
          <input type="text" name="name" id="inputName" class="form-control" placeholder="Nom" required>
        </div>
        <div class="form-group">
          <input type="email" name="email" id="inputEmail" class="form-control" placeholder="Email" required>
        </div>
        <div class="form-group">
          <textarea name="message" id="inputMessage" class="form-control" placeholder="Votre message..." required></textarea>
        </div>
        
        <button type="submit" class="btn-send" id="btnSend">
          <span id="btnSendText">Envoyer</span>
          <div class="spinner" id="btnSpinner"></div>
        </button>
        
        <div class="form-status" id="formStatus"></div>
      </form>
    </div>
  </main>

  <footer>
    <div class="footer-copyright" id="footerText">
      © 2025 HFG CAPITAL | Private Investment Office
    </div>
  </footer>

  <div class="modal-overlay" id="modalOverlay">
    <div class="modal-box">
      <span class="close-modal" onclick="closeModal()">&times;</span>
      <h3 class="modal-title" id="modalTitle">Espace Privé</h3>
      <form id="loginForm">
        <input type="text" id="userId" class="modal-input" maxlength="6" pattern="\d{6}" placeholder="Identifiant" required autocomplete="off">
        <input type="password" id="password" class="modal-input" maxlength="50" placeholder="Mot de passe" required>
        <button type="submit" class="modal-submit" id="submitBtn"><span id="btnText">Entrer</span></button>
        <div class="modal-error" id="errorMsg"></div>
      </form>
    </div>
  </div>

<script>
/* --- CONFIGURATION LANGUES --- */
const languages = {
  fr: { flag: "https://flagcdn.com/fr.svg", label: "FR", full: "Français", 
        title: "Espace Privé", btnOpen: "Accès", placeholders: ["Identifiant", "Mot de passe"], btnSubmit: "Entrer", error: "Identification impossible.", footer: "© 2025 HFG CAPITAL | Bureau d'Investissement Privé",
        menu: { home: "Accueil", about: "Qui sommes-nous", philosophy: "Philosophie", manifesto: "Manifesto", contacts: " ◆ " },
        contactTitle: "Contacts",
        formPlaceholders: { name: "Nom", email: "Email", message: "Votre message..." },
        btnSend: "Envoyer",
        btnSending: "Envoi...",
        status: { success: "Message envoyé avec succès.", error: "Une erreur est survenue." }
  },
  en: { flag: "https://flagcdn.com/gb.svg", label: "EN", full: "English", 
        title: "Private Access", btnOpen: "Access", placeholders: ["ID Code", "Password"], btnSubmit: "Enter", error: "Identification failed.", footer: "© 2025 HFG CAPITAL | Private Investment Office",
        menu: { home: "Home", about: "About Us", philosophy: "Philosophy", manifesto: "Manifesto", contacts: " ◆ " },
        contactTitle: "Contact Us",
        formPlaceholders: { name: "Name", email: "Email", message: "Your message..." },
        btnSend: "Send",
        btnSending: "Sending...",
        status: { success: "Message sent successfully.", error: "Oops! There was a problem." }
  },
  cn: { flag: "https://flagcdn.com/cn.svg", label: "CN", full: "中文", 
        title: "私人专区", btnOpen: "进入", placeholders: ["识别码", "密码"], btnSubmit: "进入", error: "验证失败。", footer: "© 2025 HFG CAPITAL | 私人投資辦公室",
        menu: { home: "首页", about: "关于我们", philosophy: "投资理念", manifesto: "愿景宣言", contacts: " ◆ " },
        contactTitle: "联系我们",
        formPlaceholders: { name: "姓名", email: "电子邮件", message: "您的留言..." },
        btnSend: "发送",
        btnSending: "发送中...",
        status: { success: "消息发送成功。", error: "发生错误。" }
  },
  es: { flag: "https://flagcdn.com/es.svg", label: "ES", full: "Español", 
        title: "Acceso Privado", btnOpen: "Acceso", placeholders: ["Identificación", "Contraseña"], btnSubmit: "Entrar", error: "Identificación fallida.", footer: "© 2025 HFG CAPITAL | Oficina de Inversiones Privadas",
        menu: { home: "Inicio", about: "Quiénes somos", philosophy: "Filosofía", manifesto: "Manifiesto", contacts: " ◆ " },
        contactTitle: "Contacto",
        formPlaceholders: { name: "Nombre", email: "Email", message: "Su mensaje..." },
        btnSend: "Enviar",
        btnSending: "Enviando...",
        status: { success: "Mensaje enviado con éxito.", error: "Hubo un error." }
  },
  de: { flag: "https://flagcdn.com/de.svg", label: "DE", full: "Deutsch", 
        title: "Privater Zugang", btnOpen: "Zugang", placeholders: ["Kennung", "Passwort"], btnSubmit: "Eintreten", error: "Identifizierung fehlgeschlagen.", footer: "© 2025 HFG CAPITAL | Privates Anlagebüro",
        menu: { home: "Startseite", about: "Über uns", philosophy: "Philosophie", manifesto: "Manifest", contacts: " ◆ " },
        contactTitle: "Kontakt",
        formPlaceholders: { name: "Name", email: "E-Mail", message: "Ihre Nachricht..." },
        btnSend: "Senden",
        btnSending: "Senden...",
        status: { success: "Nachricht erfolgreich gesendet.", error: "Ein Fehler ist aufgetreten." }
  },
  it: { flag: "https://flagcdn.com/it.svg", label: "IT", full: "Italiano", 
        title: "Accesso Riservato", btnOpen: "Accesso", placeholders: ["Identificativo", "Password"], btnSubmit: "Entra", error: "Identificazione fallita.", footer: "© 2025 HFG CAPITAL | Ufficio di Investimento Privato",
        menu: { home: "Home", about: "Chi siamo", philosophy: "Filosofia", manifesto: "Manifesto", contacts: " ◆ " },
        contactTitle: "Contatti",
        formPlaceholders: { name: "Nome", email: "Email", message: "Il tuo messaggio..." },
        btnSend: "Invia",
        btnSending: "Invio...",
        status: { success: "Messaggio inviato con successo.", error: "Si è verificato un errore." }
  },
  ru: { flag: "https://flagcdn.com/ru.svg", label: "RU", full: "Русский", 
        title: "Частный доступ", btnOpen: "Вход", placeholders: ["Идентификатор", "Пароль"], btnSubmit: "Войти", error: "Ошибка идентификации.", footer: "© 2025 HFG CAPITAL | Частный Инвестиционный Офис",
        menu: { home: "Главная", about: "О нас", philosophy: "Философия", manifesto: "Манифест", contacts: " ◆ " },
        contactTitle: "Контакты",
        formPlaceholders: { name: "Имя", email: "Email", message: "Ваше сообщение..." },
        btnSend: "Отправить",
        btnSending: "Отправка...",
        status: { success: "Сообщение успешно отправлено.", error: "Произошла ошибка." }
  },
  jp: { flag: "https://flagcdn.com/jp.svg", label: "JP", full: "日本語", 
        title: "プライベートアクセス", btnOpen: "アクセス", placeholders: ["IDコード", "パスワード"], btnSubmit: "入る", error: "認証に失敗しました。", footer: "© 2025 HFG CAPITAL | プライベート投資オフィス",
        menu: { home: "ホーム", about: "会社概要", philosophy: "投資哲学", manifesto: "マニフェスト", contacts: " ◆ " },
        contactTitle: "お問い合わせ",
        formPlaceholders: { name: "お名前", email: "メールアドレス", message: "メッセージ...", btnSending: "送信中..." },
        btnSend: "送信",
        btnSending: "送信中...",
        status: { success: "メッセージが送信されました。", error: "エラーが発生しました。" }
  },
  vn: { flag: "https://flagcdn.com/vn.svg", label: "VN", full: "Tiếng Việt", 
        title: "Truy cập riêng", btnOpen: "Truy cập", placeholders: ["Mã ID", "Mật khẩu"], btnSubmit: "Vào", error: "Xác thực thất bại.", footer: "© 2025 HFG CAPITAL | Văn phòng đầu tư tư nhân",
        menu: { home: "Trang chủ", about: "Giới thiệu", philosophy: "Triết lý", manifesto: "Tuyên ngôn", contacts: " ◆ " },
        contactTitle: "Liên hệ",
        formPlaceholders: { name: "Tên", email: "Email", message: "Tin nhắn của bạn..." },
        btnSend: "Gửi",
        btnSending: "Đang gửi...",
        status: { success: "Gửi tin nhắn thành công.", error: "Có lỗi xảy ra." }
  },
  id: { flag: "https://flagcdn.com/id.svg", label: "ID", full: "Bahasa Indonesia", 
        title: "Akses Pribadi", btnOpen: "Akses", placeholders: ["ID Pengguna", "Kata Sandi"], btnSubmit: "Masuk", error: "Identifikasi gagal.", footer: "© 2025 HFG CAPITAL | Kantor Investasi Pribadi",
        menu: { home: "Beranda", about: "Tentang Kami", philosophy: "Filosofi", manifesto: "Manifesto", contacts: " ◆ " },
        contactTitle: "Kontak",
        formPlaceholders: { name: "Nama", email: "Email", message: "Pesan Anda..." },
        btnSend: "Kirim",
        btnSending: "Mengirim...",
        status: { success: "Pesan berhasil dikirim.", error: "Terjadi kesalahan." }
  }
};

let activeLang = "fr";

/* --- BACKGROUND STABLE --- */
const bgImages = [
  "img/rouge_02.png", "img/rouge_04.png",
  "img/jaune_01.png", "img/jaune_02.png", "img/jaune_04.png", 
  "img/vert_01.png", "img/vert_02.png",    
  "img/bleu_02.png", "img/bleu_03.png", "img/bleu_04.png", "img/bleu_05.png",
  "img/orange_02.png", 
  "img/violet_01.png", "img/violet_03.png"
];

(function initBackground() {
  const STORAGE_KEY_BG = 'hfg_bg_session';
  const bgEl = document.getElementById('bgImage');
  if(bgEl) {
    let currentBg = sessionStorage.getItem(STORAGE_KEY_BG);
    if (!currentBg || !bgImages.includes(currentBg)) {
      const randomIndex = Math.floor(Math.random() * bgImages.length);
      currentBg = bgImages[randomIndex];
      sessionStorage.setItem(STORAGE_KEY_BG, currentBg);
    }
    bgEl.src = currentBg;
    bgEl.style.display = 'block';
    bgEl.onerror = function() { this.style.display='none'; sessionStorage.removeItem(STORAGE_KEY_BG); };
  }
})();

/* --- DOM ELEMENTS --- */
const modal = document.getElementById('modalOverlay');
const langMenu = document.getElementById('langMenu');
const themeBtn = document.getElementById('themeBtn');
const menuBtn = document.getElementById('menuBtn');
const mainMenuOverlay = document.getElementById('mainMenuOverlay');
const openLoginBtn = document.getElementById('openLoginBtn');
const errorMsg = document.getElementById('errorMsg');
const formStatus = document.getElementById('formStatus');

/* --- MENU --- */
function toggleMainMenu() {
  mainMenuOverlay.classList.toggle('open');
  menuBtn.classList.toggle('open');
}
menuBtn.addEventListener('click', () => toggleMainMenu());
mainMenuOverlay.addEventListener('click', (e) => { if(e.target === mainMenuOverlay) toggleMainMenu(); });

/* --- THEME --- */
themeBtn.addEventListener('click', () => {
  document.body.classList.toggle('dark-mode');
  themeBtn.classList.toggle('active');
  localStorage.setItem('hfg_theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
});

/* --- LANGUAGE LOGIC --- */
function guessLangFromBrowser() {
  const b = (navigator.language || 'en').toLowerCase();
  for(const key in languages) { if(b.startsWith(key)) return key; }
  return 'en';
}

function generateLangMenu() {
  langMenu.innerHTML = '';
  for(const code in languages) {
    const d = document.createElement('div');
    d.className = 'lang-option';
    d.innerHTML = `<img src="${languages[code].flag}"> ${languages[code].full}`;
    d.onclick = () => setLanguage(code);
    langMenu.appendChild(d);
  }
}
function toggleLangMenu() { langMenu.classList.toggle('show'); }

document.addEventListener('click', (e) => {
  if(!e.target.closest('.lang-container') && !e.target.closest('.menu-container')) langMenu.classList.remove('show');
});

function setLanguage(lang) {
  localStorage.setItem('hfg_lang', lang);
  activeLang = lang;
  const d = languages[lang];

  // Header & Footer
  document.getElementById('currentFlag').src = d.flag;
  document.getElementById('currentLangLabel').innerText = d.label;
  openLoginBtn.innerText = d.btnOpen;
  document.getElementById('footerText').innerText = d.footer;

  // Menu
  document.getElementById('menuHome').innerText = d.menu.home;
  document.getElementById('menuAbout').innerText = d.menu.about;
  document.getElementById('menuPhilosophy').innerText = d.menu.philosophy;
  document.getElementById('menuManifesto').innerText = d.menu.manifesto;
  document.getElementById('menuContacts').innerText = d.menu.contacts;

  // Login Modal
  document.getElementById('modalTitle').innerText = d.title;
  document.getElementById('userId').placeholder = d.placeholders[0];
  document.getElementById('password').placeholder = d.placeholders[1];
  document.getElementById('btnText').innerText = d.btnSubmit;
  errorMsg.innerHTML = d.error;

  // Contact Form
  document.getElementById('pageTitle').innerText = d.contactTitle;
  document.getElementById('inputName').placeholder = d.formPlaceholders.name;
  document.getElementById('inputEmail').placeholder = d.formPlaceholders.email;
  document.getElementById('inputMessage').placeholder = d.formPlaceholders.message;
  
  // Only update btn text if not currently loading
  if(!document.getElementById('btnSend').disabled) {
    document.getElementById('btnSendText').innerText = d.btnSend;
  }
  
  formStatus.innerHTML = '';
  langMenu.classList.remove('show');
}

/* --- CONTACT FORM --- */
const contactForm = document.getElementById("contactForm");

async function handleSubmit(event) {
  event.preventDefault();
  const status = document.getElementById("formStatus");
  const btn = document.getElementById("btnSend");
  const btnText = document.getElementById("btnSendText");
  const spinner = document.getElementById("btnSpinner");
  const data = new FormData(event.target);
  
  const currentLangData = languages[activeLang];
  const originalBtnText = currentLangData.btnSend;

  // SHOW LOADING
  btn.disabled = true;
  btnText.innerText = currentLangData.btnSending;
  spinner.style.display = "block";
  status.innerHTML = "";

  fetch(event.target.action, {
    method: contactForm.method,
    body: data,
    headers: { 'Accept': 'application/json' }
  }).then(response => {
    if (response.ok) {
      status.innerHTML = currentLangData.status.success;
      status.className = "form-status status-success";
      contactForm.reset();
    } else {
      response.json().then(data => {
        if (Object.hasOwn(data, 'errors')) {
          status.innerHTML = data["errors"].map(error => error["message"]).join(", ");
        } else {
          status.innerHTML = currentLangData.status.error;
        }
        status.className = "form-status status-error";
      })
    }
  }).catch(error => {
    status.innerHTML = currentLangData.status.error;
    status.className = "form-status status-error";
  }).finally(() => {
    // RESTORE BUTTON
    btn.disabled = false;
    btnText.innerText = originalBtnText;
    spinner.style.display = "none";
  });
}
contactForm.addEventListener("submit", handleSubmit);

/* --- LOGIN MODAL --- */
function openModal() { modal.classList.add('active'); setTimeout(()=>document.getElementById('userId').focus(),300); }
function closeModal() { modal.classList.remove('active'); errorMsg.style.display='none'; }
modal.addEventListener('click', (e) => { if(e.target===modal) closeModal(); });

async function sha256(str) {
  const buf = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(str));
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
}

document.getElementById('loginForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const u = document.getElementById('userId').value.trim();
  const p = document.getElementById('password').value.trim();
  
  const hU = await sha256(u);
  const hP = await sha256(p);
  const tU = "1243c7d55047487795517160a99520d309163606156578729999583763132351";
  const tP = "e551ea5c1371065311a5f10e88093119013158fa957d4bfe588a39c74f801182";

  if(hU===tU && hP===tP) {
    window.location.href = "https://0dataviz-tuqbdbgtvwg5my5krhhsma.streamlit.app/";
  } else {
    errorMsg.innerHTML = languages[activeLang].error;
    errorMsg.style.display = 'block';
  }
});

/* --- INIT --- */
document.addEventListener('DOMContentLoaded', () => {
  const savedTheme = localStorage.getItem('hfg_theme');
  if(savedTheme==='dark') { document.body.classList.add('dark-mode'); themeBtn.classList.add('active'); }
  
  generateLangMenu();
  const savedLang = localStorage.getItem('hfg_lang') || guessLangFromBrowser();
  setLanguage(savedLang);
});
</script>
</body>
</html>
